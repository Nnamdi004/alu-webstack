HAproxy Configuration for SSL Termination on [suspicious link removed]

Assumes the concatenated certificate (fullchain.pem + privkey.pem) is placed at:

/etc/ssl/certs/mydomain.pem

Server IPs used:

- web-01: 18.205.161.238

- web-02: 52.90.56.75

global
log /dev/log    local0
log /dev/log    local1 notice
chroot /var/lib/haproxy
stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
stats timeout 30s
user haproxy
group haproxy
daemon

# Increase maximum connections to handle more SSL/TLS overhead
maxconn 2000

# Default ciphers to use on SSL-enabled listening sockets.
ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
ssl-default-bind-options ssl-min-ver TLSv1.2


defaults
log global
mode http
option httplog
option dontlognull
# Shorter timeouts are generally safer and more efficient
timeout connect 5s
timeout client  50s
timeout server  50s
errorfile 400 /etc/haproxy/errors/400.http
errorfile 503 /etc/haproxy/errors/503.http

----------------------------------------------------------------------

FRONTEND 1: HTTP Listener (Port 80)

Purpose: Redirect all unencrypted HTTP traffic to the HTTPS frontend

----------------------------------------------------------------------

frontend http_in
bind *:80
# Redirect all HTTP requests to HTTPS on the same host
redirect scheme https code 301 if !{ ssl_fc }

----------------------------------------------------------------------

FRONTEND 2: HTTPS Listener (Port 443) - SSL TERMINATION

Purpose: Handle encrypted traffic, decrypt it, and forward it unencrypted

----------------------------------------------------------------------

frontend https_in
bind *:443 ssl crt /etc/ssl/certs/mydomain.pem
default_backend http_backend

----------------------------------------------------------------------

BACKEND: Web Servers (Unencrypted Port 80)

----------------------------------------------------------------------

backend http_backend
# Use roundrobin algorithm to distribute requests sequentially
balance roundrobin

# The 'check' parameter enables health checking
server web01 18.205.161.238:80 check
server web02 52.90.56.75:80 check

